# 微机原理第八章作业

> 宇文天浩 20374260

### 1 DMA的定义，DMA主要解决的问题是什么？

DMA（Direct Memory Access）:是一种内存访问技术。它允许某些计算机内部的硬件子系统，可以 独立地直接读写系统存储器，而不需绕道中央处理器（CPU）。

其解决的主要问题是通过自动化程序减少CPU对数据存储调用的时间和负载开销。

### 2 简述DMA的工作过程。 

① 外设向DMA控制器向发出 DMA请求； 

② DMA控制器向CPU发出总线请求； 

③ CPU向相应DMA控制器发出总线响应；

 ④ DMA控制器向外设发出 DMA响应确认； 

⑤ 系统转变为DMA工作方式， CPU把总线的控制权移交给 DMA控制器； 

⑥ 由DMA控制器控制外设完成数据的传输； 

⑦ DMA操作结束，把总线控制权移交给CPU。

<img src="C:\Users\86139\AppData\Roaming\Typora\typora-user-images\image-20240428181849834.png" alt="image-20240428181849834" style="zoom: 50%;" />

### 3 列出8237A的工作几种模式？ 

(1)单字节传送(single mode) ：单字节传送方式是每次DMA传送时，仅传送一个字节。传送一个字节之后，当前字节计数器减1,地址寄存器加1或减1,HRQ变为无效，释放总线控制权，将控制权交还给CPU。如果传送使得字节计数器减为0或由外设产生信号时，则终止DMA传送。**单字节传送方式的特点是：一次传送一个字节，效率较低，但它会保证在两次DMA传送之间，CPU有机会获得总线控制权。** 

(2)数据块传送(block mode)：这种数据传送方式下，8237A一旦获得总线控制权，就会连续地传送数据块，直到当前字节计数器减到0或由外设产生信号时，终止DMA传送，释放总线控制权。**数据块传送方式的特点是：一次请求传送一个数据块，效率高，** 但在整个DMA传送期间，CPU长时间无法控制总线，这样**系统动态存储器的刷新、磁盘控制器与内存间的数据传送均不能进行**， 因此微型计算机不采用这种方式。

 (3)请求传送(demand mode)：请求传送方式与数据块传送方式类似，也是一种连续传送数据的方式。区别是：8237A在请求 传送方式下，每传送一个字节就要检测一次DREQ信号是否有效，若有效，则继续传送下一个字节；若无效，则停止数据传送，结 束DMA过程。但DNA的传送现场全部保持(当前地址寄存器和当前字节计数器的值),待请求信号DREQ再次有效时，8237A接着原来的计数值和地址继续进行数据传送，直到当前字节计数器减到e或由外设产生信号时，终止DMA传送，释放总线控制权。**请求传送方式的特点是：DMA操作可由外设利用DREQ信号控制数据传送的过程。**

 (4)多片级联(cascade mode)：当一片8237A通道不够用时，可通过多片级联的方式增加DMA通道，由主、从两级构成，从 片8237A的HRQ和HLDA引脚与主片8237A的DREQ和DACK引脚连接，一片主片最多可连接四片从片。在级联方式下，从片进行 DMA传送，主片在从片与CPU之间传递联络信号。**级联方式的特点是：可扩展多个DMA通道。**

### 4 设计8237A的初始化程序。要求：通道0工作于块传送写模式，地址加1变化，允许自动预置功能；通道1工作于单字节传送，地址减1变化，禁止自动预置功能；通道2、通道3和通道1工作于相同的方式。8237A的DACK为高电平有效，DREQ为低电平有效，采用循环优先级方式启动8237A工作，8237A的首地址为50H。

<img src="C:\Users\86139\Desktop\assets\image-20240429141626971.png" alt="image-20240429141626971"  />![image-20240429141655828](C:\Users\86139\Desktop\assets\image-20240429141655828.png)

题目分析部分：
块传送：模式控制字10xxxxxx 
写模式：模式控制字xxxx01xx
通道设置：模式控制字xxxxxx00 传送通道0
地址增量：模式控制字xx0xxxxx
自动预置：模式控制字xxx0xxxx
模式控制字8237A的首地址为50H：端口的地址：高位地址 A7-A4 由系统确定，用于选中芯片（CS)，在此设为 5
DACK为高电平有效，DREQ为低电平有效:命令字11xxxxxxx
循环优先级方式：命令字xxxx1xxx
① 输出主清除命令； 
② 将传送数据的地址写入基地址与现行地址寄存器； 
③ 将传送数据的字节数写入基字节数与现行字节数寄存器； 
④ 将传送模式写入模式寄存器； 
⑤ 写入屏蔽寄存器；
 ⑥ 写入命令寄存器；（DACK/DREQ高低有效位/固定优先权)

```assembly
OUT 5DH,AL ; 输出主清命令
MOV AL,00H

MOV AL,10010100B ; 输出通道0模式字
OUT 5BH,AL
MOV AL,01100101B ; 输出通道1模式字
OUT 5BH,AL
MOV AL,01100110B ; 输出通道2模式字
OUT 5BH,AL
MOV AL,01100111B ; 输出通道3模式字
OUT 5BH,AL
MOV AL,00000000B ; 输出屏蔽字
OUT 5AH,AL 
MOV AL,11101000B ; 输出命令字
OUT 58H,AL
```